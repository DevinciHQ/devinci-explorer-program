## General build settings
#general:
#  branches:
#    only:
#      - master # Only build master

## Customize the test machine
machine:
  services:
    - docker # Enable docker

## Customize dependencies
dependencies:
  pre:
    # Install docker-compose
    - wget -q https://github.com/docker/compose/releases/download/1.1.0/docker-compose-`uname -s`-`uname -m` 
    - sudo mv docker-compose-`uname -s`-`uname -m` /usr/local/bin/docker-compose 
    - sudo chmod +x /usr/local/bin/docker-compose 
    # Configure Git
    - git config --global user.email "ci@circleci.com" && git config --global user.name "Circle CI"

## Customize test commands
test:
  pre:
  override:
    - docker-compose -f docker-compose.yml up -d
    # Set-up drupal site
    - docker-compose -f docker-compose.yml run cli bash -c 'cd /var/www/docroot/ && drush si minimal -y && drush en custom_config -y && drush fra -y && drush cc all'
    # Run behat tests
    - docker-compose -f docker-compose.yml run cli bash -c 'cd /var/www/test && composer install --prefer-source --no-interaction && vendor/behat/behat/bin/behat -p docker'
  post:
    # Copy JUnit tests for CircleCI to parse results.
    - cp -R test/junit $CIRCLE_TEST_REPORTS
    # Copy screenshots to artifacts folder to view
   # - cp -R tests/assets $CIRCLE_ARTIFACTS

## Customize deployment commands
#deployment:
#  release:
#    branch: master
#    commands:
#      - ./build.sh
